{"version":3,"sources":["../src/index.js"],"names":["Module","require","path","stateMap","WeakMap","getMutableState","obj","state","get","locked","Exception","_load","Error","_resolveFilename","_findPath","originalModulePrototype","Object","assign","create","prototype","originalModule","originalLoad","originalPrototypeLoad","load","originalResolveFilename","originalFindPath","intersect","a","b","t","length","filter","e","indexOf","EnforcementLevel","freeze","WHITELIST_ONLY","BLACKLIST_ONLY","WHITELIST_PRECEDENCE","WHITELIST_PRECEDENCE_INDIRECT","ModuleCop","enforcementLevel","blacklist","whitelist","substitute","set","name","push","index","splice","unlock","value","slice","cop","isModuleReference","match","isRequestedByWhitelistedModule","request","result","includes","parent","moduleClone","moduleStack","isMain","isModuleRequest","chain","curr","console","log","JSON","stringify","isParentWhitelisted","substitutions","hasOwnProperty","apply","require_caller","parameters","dirname","filename","basename","isWhitelisted","i","module","startsWith","undefined"],"mappings":"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","file":"index.js","sourcesContent":["debugger;\r\nconst Module = require('module');\r\nconst path = require('path');\r\n\r\nconst stateMap = new WeakMap();\r\nfunction getMutableState(obj){\r\n    let state = stateMap.get(obj);\r\n    if(state.locked){\r\n        throw new Exception('Module Cop has been locked, no further modifications are allowed');\r\n    }\r\n    return state;\r\n}\r\n\r\nif (!Module._load)\r\n{\r\n\tthrow new Error('This version of Node JS is not supported. Unable to locate Module.resolveFilename.');\r\n}\r\n\r\nif (!Module._resolveFilename)\r\n{\r\n\tthrow new Error('This version of Node JS is not supported. Unable to locate Module.resolveFilename.');\r\n}\r\n\r\nif (!Module._findPath)\r\n{\r\n\tthrow new Error('This version of Node JS is not supported. Unable to locate Module._findPath.')\r\n}\r\n\r\nconst originalModulePrototype = Object.assign(Object.create(Module.prototype.prototype || Object), Module.prototype);\r\nconst originalModule = Object.assign(Object.create(originalModulePrototype), Module);\r\n\r\nconst originalLoad = Module._load;\r\nconst originalPrototypeLoad = Module.prototype.load;\r\nconst originalResolveFilename = Module._resolveFilename;\r\nconst originalFindPath = Module._findPath\r\n\r\nfunction intersect(a, b) {\r\n    var t;\r\n    if (b.length > a.length) t = b, b = a, a = t; // indexOf to loop over shorter\r\n    return a.filter(function (e) {\r\n        return b.indexOf(e) > -1;\r\n    });\r\n}\r\n\r\nconst EnforcementLevel = Object.freeze({\r\n    WHITELIST_ONLY: 0,\r\n    BLACKLIST_ONLY: 1,\r\n    WHITELIST_PRECEDENCE: 2,\r\n    WHITELIST_PRECEDENCE_INDIRECT: 3\r\n});\r\n\r\nclass ModuleCop {\r\n    constructor() {\r\n        let state = {\r\n            locked: false,\r\n            enforcementLevel: EnforcementLevel.WHITELIST_ONLY,\r\n            blacklist: [],\r\n            whitelist: [],\r\n            substitute: {}\r\n        };\r\n\r\n        stateMap.set(this, state);\r\n    }\r\n\r\n    addToBlacklist(name){\r\n        let state = getMutableState(this);\r\n        state.blacklist.push(name);\r\n    }\r\n\r\n    removeFromBlacklist(name){\r\n        let state = getMutableState(this);\r\n        let index = state.blacklist.indexOf(name);\r\n        if(index >= 0){\r\n            state.blacklist.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    addToWhitelist(name){\r\n        let state = getMutableState(this);\r\n        state.whitelist.push(name);\r\n    }\r\n\r\n    removeFromWhitelist(name){\r\n        let state = getMutableState(this);\r\n        let index = state.whitelist.indexOf(name);\r\n        if(index >= 0){\r\n            state.whitelist.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    addModuleSubstitution(name, substitute){\r\n        let state = getMutableState(this);\r\n        state.substitute[name] = substitute;\r\n    }\r\n\r\n    removeModuleSubstitution(name){\r\n        let state = getMutableState(this);\r\n        delete state.substitute[name];\r\n    }\r\n\r\n    lock (){\r\n        let state = stateMap.get(this);\r\n        state.locked = true;\r\n\r\n        return {\r\n            unlock: () => {\r\n                let state = stateMap.get(this);\r\n                state.locked = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    get enforcementLevel(){\r\n        let state = stateMap.get(this);\r\n        return state.enforcementLevel;\r\n    }\r\n    set enforcementLevel(value){\r\n        let state = getMutableState(this);\r\n        state.enforcementLevel = value;\r\n    }\r\n\r\n    get whitelist() {\r\n        let state = stateMap.get(this);\r\n        return state.whitelist.slice(0);\r\n    }\r\n\r\n    get blacklist() {\r\n        let state = stateMap.get(this);\r\n        return state.blacklist.slice(0);\r\n    }\r\n\r\n    get substitutions(){\r\n        let state = stateMap.get(this);\r\n        return Object.assign({}, state.substitute);\r\n    }\r\n}\r\n\r\nlet cop = new ModuleCop();\r\n\r\nfunction isModuleReference(name){\r\n    return (typeof name === 'string' && !name.match(/^\\.|^[a-zA-Z]:|[/\\\\]/));\r\n}\r\n\r\nfunction isRequestedByWhitelistedModule(request){\r\n    let result = false;\r\n    let name = request.name;\r\n    while(!result && request){\r\n        if(isModuleReference(name) && cop.whitelist.includes(name)){\r\n            result = true;\r\n        }\r\n\r\n        request = request.parent;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n//Don't assign it here, because we need to ensure that the methods are\r\n//overridden before cloning.\r\nlet moduleClone = null;\r\nlet moduleStack = [];\r\nModule._load = function(request, parent, isMain){\r\n    let isModuleRequest = isModuleReference(request);\r\n    switch(cop.enforcementLevel){\r\n        case EnforcementLevel.WHITELIST_ONLY:\r\n            let chain = [];\r\n            let curr = parent;\r\n            while(curr){\r\n                if(curr.request){\r\n                    chain.push(curr.request);\r\n                }\r\n                curr = curr.parent;\r\n            }\r\n            console.log('Requested: ' + request);\r\n            console.log('Load chain: ' + JSON.stringify(chain));\r\n            console.log('White list: ' + JSON.stringify(cop.whitelist));\r\n            if(isModuleRequest && !cop.whitelist.includes(request) && intersect(cop.whitelist, chain).length < 1){\r\n                throw new Error('The loading of the module was prevented due to security restrictions');\r\n            }\r\n            break; \r\n        case EnforcementLevel.BLACKLIST_ONLY:\r\n            if(isModuleRequest && cop.blacklist.includes(request)){\r\n                throw new Error('The loading of the module was prevented due to security restrictions');\r\n            }\r\n            break;\r\n        case EnforcementLevel.WHITELIST_PRECEDENCE: {\r\n            let isParentWhitelisted\r\n            if(isModuleRequest && cop.blacklist.includes(request) && !isRequestedByWhitelistedModule(request)){\r\n                throw new Error('The loading of the module was prevented due to security restrictions');\r\n            }\r\n            break;\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    let substitutions = cop.substitutions;\r\n    if(isModuleRequest && cop.substitutions.hasOwnProperty(request)){\r\n        return substitutions[request];\r\n    }\r\n\r\n    moduleClone = moduleClone || Object.assign(Object.create(Module.prototype), Module);\r\n\r\n    if('module' === request)\r\n    {\r\n        if(cop.whitelist.includes(request)){\r\n            return originalModule;\r\n        }else{\r\n            return moduleClone\r\n        }\r\n    }\r\n\r\n\r\n    return originalModule._load.apply(this, [request, parent, isMain]);\r\n};\r\n\r\nvar require_caller = null;\r\n// instrument Module._resolveFilename\r\n// https://github.com/nodejs/node/blob/master/lib/module.js#L322\r\n//\r\n// `arguments` would conflict with Babel, therefore `...parameters`\r\n//\r\n// const native_module = require('native_module')\r\nModule._resolveFilename = function(...parameters)\r\n{\r\n\tconst request = parameters[0];\r\n\tconst parent = parameters[1];\r\n\r\n    //console.log('Filename: ' + request);\r\n\r\n\t// take note of the require() caller\r\n\t// (the module in which this require() call originated)\r\n    require_caller = parent;\r\n\r\n    let result = originalModule._resolveFilename.apply(this, parameters);\r\n    if(isModuleReference(request)){\r\n        moduleStack.push({name: request, dirname: path.dirname(result), filename: path.basename(result)});\r\n    }\r\n\r\n    let isWhitelisted = false;\r\n    for(let i = moduleStack.length - 1; i >= 0; i--){\r\n        let module = moduleStack[i];\r\n        if(result.startsWith(module.dirname)){\r\n            isWhitelisted = true;\r\n            moduleStack = moduleStack.slice(0, i);\r\n            break;\r\n        }\r\n    }\r\n\r\n    if(cop.enforcementLevel == EnforcementLevel.WHITELIST_ONLY && !isWhitelisted){\r\n        throw new Error('Attempted to load file not part of a whitelisted module. File path: ' + result);\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n// instrument Module._findPath\r\n// https://github.com/nodejs/node/blob/master/lib/module.js#L335-L341\r\n//\r\n// `arguments` would conflict with Babel, therefore `...parameters`\r\n//\r\nModule._findPath = (...parameters) =>\r\n{\r\n\tconst request = parameters[0];\r\n\t// const paths = parameters[1]\r\n\r\n    // preceeding resolvers\r\n    console.log('Request: ' + request);\r\n\t// if (require_hacker.global_hooks_enabled)\r\n\t// {\r\n\t// \tfor (let resolver of require_hacker.preceding_path_resolvers)\r\n\t// \t{\r\n\t// \t\tconst resolved_path = resolver(request, require_caller)\r\n\t// \t\tif (exists(resolved_path))\r\n\t// \t\t{\r\n\t// \t\t\treturn resolved_path\r\n\t// \t\t}\r\n\t// \t}\r\n\t// }\r\n\r\n\t// original Node.js loader\r\n\tconst filename = originalModule._findPath.apply(undefined, parameters);\r\n\tif (filename !== false)\r\n\t{\r\n\t\treturn filename;\r\n\t}\r\n\r\n\t// rest resolvers\r\n\t// if (require_hacker.global_hooks_enabled)\r\n\t// {\r\n\t// \tfor (let resolver of require_hacker.path_resolvers)\r\n\t// \t{\r\n\t// \t\tconst resolved = resolver.resolve(request, require_caller)\r\n\t// \t\tif (exists(resolved))\r\n\t// \t\t{\r\n\t// \t\t\treturn resolved\r\n\t// \t\t}\r\n\t// \t}\r\n\t// }\r\n\r\n\treturn false\r\n};\r\n\r\nexport {EnforcementLevel};\r\nexport default cop;"]}